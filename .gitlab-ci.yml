
image: node:10-alpine

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
  - /usr/local/share/.cache

stages:
- "Install"
- "Run tests"
- "Deploy new mappings"

Install:
  stage: "Install"
  script:
  - yarn cache dir
  - yarn --frozen-lockfile
  artifacts:
    expire_in: "1 day"
    paths:
    - node_modules

Run tests:
  stage: "Run tests"
  script:
  - yarn test
  after_script:
  - npx codecov

Deploy new mappings:
  stage: "Deploy new mappings"
  only:
    changes:
      - mapping.json
  script:
  - yarn convert-mapping
  - yarn deploy

